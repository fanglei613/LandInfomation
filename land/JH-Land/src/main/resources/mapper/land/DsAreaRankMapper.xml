<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.land.mapping.IDsAreaRankMapper" >
  <resultMap id="BaseResultMap" type="com.jh.land.entity.DsAreaRank" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="region_id" property="regionId" jdbcType="BIGINT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="data_status" property="dataStatus" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
    <result column="creator" property="creator" jdbcType="INTEGER" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="modifier_name" property="modifierName" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="INTEGER" />
    <result column="crop_id" property="cropId" jdbcType="INTEGER" />
    <result column="area" property="area" jdbcType="NUMERIC" />
    <result column="year" property="year" jdbcType="INTEGER" />
    <result column="data_type" property="dataType" jdbcType="INTEGER" />
    <result column="publish_status" property="publishStatus" jdbcType="INTEGER" />
    <result column="publish_time" property="publishTime" jdbcType="TIMESTAMP" />
    <result column="publisher_name" property="publisherName" jdbcType="VARCHAR" />
    <result column="data_time" property="dataTime" jdbcType="DATE" />
    <result column="del_flag" property="delFlag" jdbcType="CHAR" />
    <result column="publisher" property="publisher" jdbcType="INTEGER" />
    <result column="resolution" property="resolution" jdbcType="INTEGER" />
    <result column="product_id" property="productId" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, region_id, remark, data_status, create_time, creator_name, creator, modify_time,
    modifier_name, modifier, crop_id, area, year, data_type, publish_status, publish_time,
    publisher_name, data_time, del_flag, publisher, resolution, product_id
  </sql>

  <insert id="insertSelective" parameterType="com.jh.land.entity.DsAreaRank" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ds_area_rank
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="regionId != null" >
        region_id,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="dataStatus != null" >
        data_status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="creatorName != null" >
        creator_name,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="modifyTime != null" >
        modify_time,
      </if>
      <if test="modifierName != null" >
        modifier_name,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="cropId != null" >
        crop_id,
      </if>
      <if test="area != null" >
        area,
      </if>
      <if test="year != null" >
        year,
      </if>
      <if test="dataType != null" >
        data_type,
      </if>
      <if test="publishStatus != null" >
        publish_status,
      </if>
      <if test="publishTime != null" >
        publish_time,
      </if>
      <if test="publisherName != null" >
        publisher_name,
      </if>
      <if test="dataTime != null" >
        data_time,
      </if>
      <if test="delFlag != null" >
        del_flag,
      </if>
      <if test="publisher != null" >
        publisher,
      </if>
      <if test="resolution != null" >
        resolution,
      </if>
      <if test="productId != null" >
        product_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="regionId != null" >
        #{regionId,jdbcType=BIGINT},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="dataStatus != null" >
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null" >
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null" >
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null" >
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="cropId != null" >
        #{cropId,jdbcType=INTEGER},
      </if>
      <if test="area != null" >
        #{area,jdbcType=NUMERIC},
      </if>
      <if test="year != null" >
        #{year,jdbcType=INTEGER},
      </if>
      <if test="dataType != null" >
        #{dataType,jdbcType=INTEGER},
      </if>
      <if test="publishStatus != null" >
        #{publishStatus,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null" >
        #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publisherName != null" >
        #{publisherName,jdbcType=VARCHAR},
      </if>
      <if test="dataTime != null" >
        #{dataTime,jdbcType=DATE},
      </if>
      <if test="delFlag != null" >
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="publisher != null" >
        #{publisher,jdbcType=INTEGER},
      </if>
      <if test="resolution != null" >
        #{resolution,jdbcType=INTEGER},
      </if>
      <if test="productId != null" >
        #{productId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <!--查询分布时间轴信息  -->
  <!-- <select id="findRankAreaTimes1" resultType="java.lang.String" parameterType="com.jh.land.model.RankAreaVO" >
     SELECT DISTINCT
     (d.data_time)
     FROM
     #{areaTableName,jdbcType=VARCHAR} d,
     #{rankTableName,jdbcType=VARCHAR} r
     WHERE
     d.del_flag = '1'
     AND d.data_status = '1'
     AND d.region_id = r.rank_id
     AND publish_status = 2201
     <if test="regionId != null" >
       and (r.parent_id =#{regionId} or  r.parent_id in (select region_id from init_region where del_flag='1' and data_status='1' and parent_id=#{regionId}))
     </if>
     <if test="cropId != null" >
       and  d.crop_id = #{cropId}
     </if>
     <if test="resolution != null" >
       and  d.resolution = #{resolution}
     </if>
     <if test="startDate != null and endDate != null"  >
       and  d.data_time BETWEEN  #{startDate} and #{endDate}
     </if>
     order by d.data_time asc
   </select>
 -->
  <!--查询分布信息统计 -->
  <select id="findAllRankAreaTables" resultType="java.lang.String">
    SELECT DISTINCT(table_name) as tableName
    from information_schema.columns
    WHERE table_name LIKE 'ds_area_rank_%'
  </select>

  <select id="findRankAreaTimes" parameterType="com.jh.land.model.RankAreaParam" resultType="com.jh.land.entity.RankAreaTimes">
      SELECT DISTINCT
      (d.data_time) as dataTime,d.crop_id as cropId,d.resolution,substr(cast(region_id as VARCHAR),5,9) as regionId
      FROM
      ${rankAreaTableName} d
      WHERE
      d.del_flag = '1'
      AND d.data_status = '1'
      AND publish_status = 2201 and d.crop_id !=0
  </select>

  <update id="publishData" parameterType="com.jh.land.model.RankAreaVO">
    update ${areaTableName} set publish_status = #{publishStatus,jdbcType=INTEGER} where product_id = #{productId,jdbcType=INTEGER}
  </update>

  <select id="findAreaRankCropById" parameterType="com.jh.land.model.RankAreaVO" resultType="com.jh.land.entity.DsAreaRank">
  SELECT
  <include refid="Base_Column_List"/>
  FROM
    ${areaTableName}
    where region_id = #{regionId,jdbcType=BIGINT}
  ORDER BY
    data_time DESC
  </select>
</mapper>