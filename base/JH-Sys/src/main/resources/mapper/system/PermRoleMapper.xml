<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.system.mapping.IPermRoleMapper" >
  <resultMap id="BaseResultMap" type="com.jh.system.entity.PermRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="role_code" property="roleCode" jdbcType="VARCHAR" />
    <id column="role_id" property="roleId" jdbcType="INTEGER" />
    <result column="data_status" property="dataStatus" jdbcType="CHAR" />
    <result column="del_flag" property="delFlag" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="DATE" />
    <result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
    <result column="creator" property="creator" jdbcType="INTEGER" />
    <result column="modify_time" property="modifyTime" jdbcType="DATE" />
    <result column="modifier_name" property="modifierName" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="INTEGER" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="role_name" property="roleName" jdbcType="VARCHAR" />
    <result column="role_type" property="roleType" jdbcType="INTEGER" />
    <result column="account_id" jdbcType="INTEGER" property="accountId" />
    <result column="order_file_num" jdbcType="INTEGER" property="orderFileNum" />
  </resultMap>
  <sql id="Base_Column_List" >
    role_code, role_id, data_status, del_flag, create_time, creator_name, creator, modify_time,
    modifier_name, modifier, remark, role_name,role_type,order_file_num
  </sql>

  <sql id="Role_Column_List" >
    a.role_code, a.role_id, a.data_status, a.role_name,a.role_type,a.order_file_num
  </sql>


  <select id="findAll" parameterType="Integer" resultMap="BaseResultMap">
    select a.role_id, a.role_code, a.role_name,b.account_id from sys_perm_role  a
    left join sys_relate_account_role b on a.role_id = b.role_id and  b.account_id = #{accountId}
    where a.data_status = '1'
  </select>

  <select id="findByPage" resultMap="BaseResultMap" parameterType="RoleParam">
    select
    <include refid="Base_Column_List" />
    from sys_perm_role where data_status = '1'
    <if test="roleCode != null and roleCode != ''">
      and role_code = #{roleCode, jdbcType=VARCHAR}
    </if>

    <if test="roleName != null and roleName != ''">
      and role_name like '%' || #{roleName,jdbcType=VARCHAR} ||'%'
    </if>

    <if test="roleType != null">
      and role_type = #{roleType,jdbcType=INTEGER}
    </if>

    order by role_id desc

  </select>

  <!--根据角色编码获取角色名称-->
  <select id="getByRoleCode" parameterType="String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from sys_perm_role
    where data_status = '1' and role_code = #{roleCode,jdbcType=VARCHAR}
  </select>

  <select id="findRoleByAccountId" parameterType="Integer" resultMap="BaseResultMap">
    select <include refid="Role_Column_List" />
    from  sys_perm_role a left join sys_relate_account_role b on a.role_id = b.role_id
    where a.del_flag = '1' and  b.account_id = #{accountId,jdbcType=INTEGER}

  </select>

  <select id="getById" resultMap="BaseResultMap" parameterType="Integer" >
    select
    <include refid="Base_Column_List" />
    from sys_perm_role
    where   role_id = #{roleId,jdbcType=INTEGER}
  </select>
  <delete id="delete" parameterType="Integer" >
    delete from sys_perm_role
    where   role_id = #{roleId,jdbcType=INTEGER}
  </delete>
  <insert id="save" parameterType="PermRole" >
    insert into sys_perm_role
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="roleCode != null" >
        role_code,
      </if>
      <if test="dataStatus != null" >
        data_status,
      </if>
      <if test="delFlag != null" >
        del_flag,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="creatorName != null" >
        creator_name,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="modifyTime != null" >
        modify_time,
      </if>
      <if test="modifierName != null" >
        modifier_name,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="roleName != null" >
        role_name,
      </if>
      <if test="roleType != null">
        role_type,
      </if>
      <if test="orderFileNum != null">
        order_file_num,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="roleCode != null" >
        #{roleCode,jdbcType=VARCHAR},
      </if>
      <if test="dataStatus != null" >
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null" >
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=DATE},
      </if>
      <if test="creatorName != null" >
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null" >
        #{modifyTime,jdbcType=DATE},
      </if>
      <if test="modifierName != null" >
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="roleName != null" >
        #{roleName,jdbcType=VARCHAR},
      </if>
      <if test="roleType != null">
        #{roleType,jdbcType=INTEGER},
      </if>
      <if test="orderFileNum != null">
        #{orderFileNum,jdbcType=INTEGER}
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="PermRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_perm_role
    <set >
      <if test="dataStatus != null" >
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null" >
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=DATE},
      </if>
      <if test="creatorName != null" >
        creator_name = #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null" >
        modify_time = #{modifyTime,jdbcType=DATE},
      </if>
      <if test="modifierName != null" >
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="roleName != null" >
        role_name = #{roleName,jdbcType=VARCHAR},
      </if>
      <if test="roleType != null">
        role_type = #{roleType,jdbcType=INTEGER},
      </if>
      order_file_num = #{orderFileNum,jdbcType=INTEGER},
    </set>
    where role_code = #{roleCode,jdbcType=VARCHAR}
      and role_id = #{roleId,jdbcType=INTEGER}
  </update>

  <!--取消菜单权限关联-->
  <delete id="unRelateResource" parameterType="Integer">
    delete from sys_relate_role_res where role_id =#{roleId, jdbcType=INTEGER}
  </delete>

  <!--关联菜单权限-->
  <insert id="relateResource" parameterType="RelateRoleRes">
    insert into sys_relate_role_res(role_id , res_id) values(#{roleId, jdbcType=INTEGER}, #{resId, jdbcType=INTEGER})
  </insert>

  <!-- 是否存在某角色 -->
  <select id="isExistRole" parameterType="PermRole" resultType="Integer">
    select count(1) as total
    from  sys_perm_role a left join sys_relate_account_role b on a.role_id = b.role_id
    where a.del_flag = '1' and  b.account_id = #{accountId,jdbcType=INTEGER}
    and a.role_code = #{roleCode,jdbcType=VARCHAR}

  </select>







</mapper>